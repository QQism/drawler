{% extends "base.html" %}
{% load i18n %}
{% load django_bootstrap_breadcrumbs %}
{% block css %}
{% endblock %}

{% block content %}
<div class="row-fluid">
    <div class="span12 wrapper">
        {% if profile %}
        {% block breadcrumbs %}
        {% breadcrumb "Home" "/" %}
        {% breadcrumb "Profile" "scraper:home"  %}
        {% breadcrumb profile.name|escape "" %}
        {% endblock %}

        {% render_breadcrumbs %}
        <div class="well">
            {{ profile.name }} || {{ profile.url }} || 

            {% for word in profile.keywords %}
            {{ word }}
            {% endfor %}
        </div>
    <div class="span2 side-column well">
        <ul class="nav nav-pills nav-stacked">
            <li><a href="{% url scraper:new_session profile.pk %}"><span>Create a new one</span></a></li>
            {% for session in sessions %}
            {% if session.pk == current_session.pk %}
            <li class="active">
            {% else %}
            <li>
            {% endif %}
                <a href="{% url scraper:session profile.pk session.pk  %}">{{ session.created_at }}
                    {% if session.status == 'C' %}
                    <span class="label label-success">{{ session.get_status_display }}</span>
                    {% elif session.status == 'W' %}
                    <span class="label label">{{ session.get_status_display }}</span>
                    {% elif session.status == 'P' %}
                    <span class="label label-info">{{ session.get_status_display }}</span>
                    {% elif session.status == 'F' %}
                    <span class="label label-important">{{ session.get_status_display }}</span>
                    {% endif %}
                </a>
            </li>
            {% empty %}
            <b>Don't have any session yet!</b>
            <a><span>Create a new one</span></a>
            {% endfor %}
        </ul>
    </div>
    <div class="span9">
        {% if form %}
        <h3>New Session</h3>
        <form action='{% url scraper:sessions profile.pk %}' method='POST'>
            {% csrf_token %}
            {{ form.as_p }}
            <input type='submit' value='Scrape'/>
        </form>
        {% endif %}

        {% if nodes %}
        <h2>Results</h2>
        <div class="accordion" id="accordion2">
            {% for node in nodes %}
            <div class="accordion-group">
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse{{ forloop.counter }}">
                        {{ node.0 }} || {{ node.1 }} || {{ node.2 }}
                    </a>
                </div>
                <div id="collapse{{ forloop.counter }}" class="accordion-body collapse in">
                    <div class="accordion-inner">
                        {% if node.3 %}
                        <pre>
                        {{ node.3 }}
                        </pre>
                        {% else %}
                        <span>No appropriated content</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% else %}
    <h3>Cannot find profile</h3>
    {% endif %}
    </div>
</div>
{% endblock %}
{% block javascript %}
<script>
(function () {
    function update_pages(){
    //console.log('ookkk');
    }

    function refresh_table(){

    }

    function mark_keywords(){
    
    }

    setInterval(update_pages, 2000)
}).call(this);
</script>
{% endblock %}
